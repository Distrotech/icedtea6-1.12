diff -BbruN openjdkold/jdk/src/share/native/sun/java2d/cmm/lcms/cmsxform.c openjdk/jdk/src/share/native/sun/java2d/cmm/lcms/cmsxform.c
--- oldopenjdk6/jdk/src/share/native/sun/java2d/cmm/lcms/cmsxform.c	2009-04-24 03:34:31.000000000 -0400
+++ openjdk/jdk/src/share/native/sun/java2d/cmm/lcms/cmsxform.c	2009-05-01 10:15:13.000000000 -0400
@@ -689,6 +689,9 @@
                 GrayTRC = cmsReadICCGamma(hProfile, icSigGrayTRCTag);
                 FromLstarToXYZ(GrayTRC, Shapes1);
 
+                if (GrayTRC == NULL)
+                  return NULL;
+
                 // Reversing must be done after curve translation
 
                 Shapes[0] = cmsReverseGamma(Shapes1[0]->nEntries, Shapes1[0]);
@@ -704,6 +707,9 @@
 
                 GrayTRC = cmsReadICCGammaReversed(hProfile, icSigGrayTRCTag);   // Y
 
+                if (GrayTRC == NULL)
+                  return NULL;
+
                 Shapes[0] = cmsDupGamma(GrayTRC);
                 Shapes[1] = cmsDupGamma(GrayTRC);
                 Shapes[2] = cmsDupGamma(GrayTRC);
@@ -1343,7 +1349,7 @@
                      p -> ToDevice = PCStoShaperMatrix;
                      p -> OutMatShaper = cmsBuildOutputMatrixShaper(p->OutputProfile);
 
-                     if (!p -> OutMatShaper) {
+                     if (!p || !p -> OutMatShaper) {
                             cmsSignalError(LCMS_ERRC_ABORTED, "profile is unsuitable for output");
                             return NULL;
                             }
@@ -1920,6 +1926,8 @@
 
         ColorSpace = ColorSpaceIn;
 
+	Transforms[i] = NULL;
+
 
         if (ColorSpace == CurrentColorSpace) {
 
@@ -1969,6 +1977,11 @@
                 goto ErrorCleanup;
         }
 
+	if (Transforms[i] == NULL) {
+          cmsSignalError(LCMS_ERRC_ABORTED, "cmsCreateMultiprofileTransform: Invalid profile");
+          goto ErrorCleanup;
+	} 
+
         CurrentColorSpace = ColorSpaceOut;
 
     }
